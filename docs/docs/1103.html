<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Migrating Print Service from Windows Server 2003/2008 (x86) to 2008 R2 (x64)
</title>
  <meta name="description" content="You will be coming in the scenario where you will have to do a cross platform migrating of your print servers. Windows Server 2008 R2 is an x64 operation sys...">

  
  
  <link rel="stylesheet" href="/docs/css/main.css">
  <link rel="canonical" href="/docs/1103">
  <link rel="alternate" type="application/rss+xml" title="ITBlog.no" href="/docs/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">

    
    
    <a class="site-title" href="/docs/">ITBlog.no</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15" width="18px" height="15px">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
        
          
          <a class="page-link" href="/docs/authors/">Authors</a>
          
        
          
          <a class="page-link" href="/docs/terms-of-use/">Disclaimer</a>
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Migrating Print Service from Windows Server 2003/2008 (x86) to 2008 R2 (x64)
</h1>
    <p class="post-meta"><time datetime="2012-04-25T05:04:25+02:00" itemprop="datePublished">Apr 25, 2012</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">kmhuglen</span></span></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>You will be coming in the scenario where you will have to do a cross platform migrating of your print servers. Windows Server 2008 R2 is an x64 operation system and a regular backup and restore is not gone cut it anymore. Great blog posts about this on TechNet:</p>

<ul>
  <li>Cross-Architecture print server migrations: Speeding up the migration process</li>
  <li>Best practices on deploying a Microsoft Windows Server 2008/Windows Server 2008 R2 Print Server</li>
  <li>Migrating Print Queues quickly using PRINTBRM, configuration files, and the Generic/Text Only Driver</li>
  <li>Two Minute Drill: PRINTBRM and the Configuration File</li>
</ul>

<p>Almost everything in this post is gathered from those blog posts. I recommend reading the original blog post as mine is simplified for my own use.</p>

<p><strong>Requirements</strong></p>

<ul>
  <li>A Vista/2008 or higher computer with the Print Management Snap-in installed.
    <ul>
      <li>Make a temporary folder for the output data, share it and open CMD from that folder.</li>
    </ul>
  </li>
  <li>A source server running Windows Server 2003/2008 (x86)</li>
  <li>A target server running Windows Server 2008 R2 (se Preparing the new Print Server below)</li>
</ul>

<h3 id="exporting-and-importing-print-queues">Exporting and importing print queues</h3>

<p>Run the following command against the source server:</p>

<p>[code]C:WindowsSystem32spooltoolsPrintBrm.exe -B -S SOURCESERVER -F NOBIN_SOURCESERVER.PrinterExport -NOBIN[/code]</p>

<p>This will create an export of all queues on the SOURCESERVER without the drivers (binaries).</p>

<p>Then download the CreateBRMConfigXML.vbs script and save it to the temporary folder/share accessable from the SOURCESERVER.</p>

<p>[code]strComputer = “.”</p>

<p>quote= chr(34)</p>

<p>XMLtag=””</p>

<p>drvold=””</p>

<p>Set objWMIService = GetObject(“winmgmts:” &amp; strComputer &amp; “rootCIMV2”)</p>

<p>Set colItems = objWMIService.ExecQuery( _</p>

<p>“SELECT * FROM Win32_PrinterDriver”,,48)</p>

<p>Wscript.Echo XMLtag</p>

<p>Wscript.Echo “”</p>

<p>Wscript.Echo “”</p>

<p>For Each objItem in colItems</p>

<p>‘Wscript.Echo “”</p>

<p>Wscript.Echo drvold &amp; ExtractDriverName(objitem.Name) &amp;newdrv</p>

<p>Next</p>

<p>Wscript.Echo “”</p>

<p>Wscript.Echo “”</p>

<p>Wscript.Quit</p>

<p>Function ExtractDriverName(dName)</p>

<p>ExtractDriverName = Left(dName,(InStr(dName,”,”)-1))</p>

<p>End Function[/code]</p>

<p>Logon to the SOURCESERVER and open CMD, run the following command from the source server:</p>

<p>[code]Cscript.exe //NOLOGO TEMPSHARECreateBRMConfigXML.vbs &gt; TEMPSHARESOURCESERVER_DriverMapping.XML[/code]</p>

<p>The <em>SOURCESERVER_DriverMapping.XML</em> will now have a mapping table for all queues and their driver, where the driver is replaced with a Generic / Text Only driver.</p>

<p>You can now import the <em>NOBIN_SOURCESERVER.PrinterExport</em> using the <em>SOURCESERVER_DriverMapping.XML</em> as a configuration file, and all queues would be imported with the generic driver.</p>

<p>Or you could open the <em>SOURCESERVER_DriverMapping.XML</em> in Excel 2010, select open as XML table, and alter the mapping table to use OEM universal drivers or OEM specific print drivers.</p>

<p>Remember to install both the x86 <strong>AND</strong> x64 driver on the target system prior to importing the queues. Driver names must match <strong>EXACTLY</strong> with the installed driver.</p>

<p>To import the exported queues using the _DriverMapping.XML_file run the following command:</p>

<p>[code]C:WindowsSystem32spooltoolsPrintbrm.exe –R –S TARGETSERVER -F NOBIN_SOURCESERVER.PrinterExport –C SOURCESERVER_DriverMapping.XML –O FORCE -NOBIN[/code]</p>

<blockquote>
  <p>PS: You will get an error running the above command on a newly installed print server. Create a printer queue and share it to make the print$ share available on the new  print server.</p>
</blockquote>

<p>If you get error on some of the printer queue, then there may be a problem with the print processor. The easy solution would be to change the print prosessor on the source server before backing up the print queue.</p>

<p>Use the SetPrinter.EXE tool located in the Windows Server 2003 Resource Kit or use PowerShell</p>

<p>List all Printers and the corresponding Print Processor:</p>

<table>
  <tbody>
    <tr>
      <td>[code]Get-WmiObject Win32_Printer</td>
      <td>ft name,printprocessor[/code]</td>
    </tr>
  </tbody>
</table>

<p>Set all Printer to WinPrint</p>

<p>[Code]Missing PowerShell Commando[/code]</p>

<p>Another solution is to change the print processor in the printerExport file.</p>

<p>Unpack the printerExport file and open the {guid}.xml file corresponding to the failed queue, change the printprocessor=”OLDVALUE” to printprocessor=”NEWVALUE”. NEWVALUE would be the corresponding print processor for the installed driver on the target server.</p>

<p>Unpack the printerExport file:</p>

<p>[code]C:WindowsSystem32spooltoolsPrintbrm.exe -D NOBIN_SOURCESERVER_PRINTEXPORT_UNPACK -R -F NOBIN_SOURCESERVER.PrinterExport[/code]</p>

<p>Compress the altered folder into printerExport again:</p>

<p>[code]C:WindowsSystem32spooltoolsPrintbrm.exe -D NOBIN_SOURCESERVER_PRINTEXPORT_UNPACK -B -F NOBIN_SOURCESERVER_MODIFIED.PrinterExport[/code]</p>

<h3 id="preparing-the-new-print-server">Preparing the new Print Server:</h3>

<h4 id="disable-the-terminal-server-remote-desktop-print-redirection">Disable the Terminal Server (Remote Desktop) Print Redirection</h4>

<p>Click on Start, Control Panel, Administrative Tools, Terminal Services, Terminal Services Configuration (Run as Administrator), right click on the RDP-Tcp, click on Properties, Client Settings tab, under the “Disable the following”, check the box for Windows Printer. Click on Ok, Log off, Log back in, Click on Start, Control Panel, Printers, delete all the print queues there. Click on Server Properties, Click on the Drivers tab, Select all the driver (shift key), Click on Remove…  Stop and restart the Print Spooler service</p>

<h4 id="antivirus-exeptions">Antivirus exeptions</h4>

<p>Make sure that your antivirus doesn’t scan *.spl, *.shd or *.tmp files (or c:windowssystem32spoolprinters folder standalone or c:windowssystem32spool{GUID}printers for clusters)</p>

<h4 id="print-drivers">Print drivers</h4>

<p>Start with the latest universal driver, if not good enough then try OEM specific drivers, but keep only one, PCL 5, PCL 6 or Postscript (PS) in the driver catalog.</p>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">ITBlog.no</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              ITBlog.no
            
            </li>
          <li><a href="mailto:kmhuglen@outlook.com">kmhuglen@outlook.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/kmhuglen"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">kmhuglen</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/kmhuglen"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">kmhuglen</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Works at Firstpoint Bergen in Norway as an IT Solution Architect. Focus area is Cloud Infrastructure, Integrations and IT Service Management
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
